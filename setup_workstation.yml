- name: Setup networking
  hosts: localhost
  gather_facts: no
  roles:
    - wifi-client

- name: Wait for networking
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Wait for network connectivity
      wait_for:
        path: /etc/resolv.conf
        search_regex: ^nameserver
      tags:
        - wait

- name: Make system-level changes
  hosts: localhost
  roles:
    - luks
    - workstation

- name: Setup user-level changes
  hosts: localhost
  become: yes
  become_user: "{{ workstation_user }}"
  roles:
    - dotfiles
    - duplicity
    - kde_user
    - workstation_user
